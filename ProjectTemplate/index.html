<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Feedback Webpage</title>
    <!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <!--YOUR OWN JAVASCRIPT CAN GO RIGHT HERE-->
    <script type="text/javascript">
        // Data arrays to be globally scoped so they can be accessed by export functions
        let upvoteCategories = [];
        let upvoteCountData = [];
        let categoryCategories = [];
        let categoryPosts = [];
        let postsData = {};

        function TestButtonHandler() {
            var webMethod = "ProjectServices.asmx/TestConnection";
            var parameters = "{}";

            //jQuery ajax method
            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var responseFromServer = msg.d;
                    alert(responseFromServer);
                },
                error: function (e) {
                    alert("this code will only execute if javascript is unable to access the webservice");
                }
            });
        }
        var contentPanel = ["logonPanel", "feedbackPanel", "editPostPanel", "managerDashboardPanel"];
        // Funtion to change active panel being displayed
        function showPanel(panelName) {
            clearData();
            for (var i = 0; i < contentPanel.length; i++) {
                if (panelName == contentPanel[i]) {
                    $("#" + contentPanel[i]).css("display", "block");

                } else {
                    $("#" + contentPanel[i]).css("display", "none");
                }

            }

        }

        // Function to LogOn to system
        function LogOn(userId, pass) {

            var webMethod = "ProjectServices.asmx/LogOn";
            var parameters = "{\"userid\":\"" + encodeURI(userId) + "\",\"pass\":\"" + encodeURI(pass) + "\"}";

            //jQuery ajax method
            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d) {
                        // Store the user ID in localStorage
                        sessionStorage.setItem('userId', userId);
                        sessionStorage.setItem("admin", msg.d.isAdmin);

                        //server replied true, so show the accounts panel
                        showPanel('feedbackPanel');
                        GetPosts();

                        $(".feedbackPopup").show();

                        // Store the user ID and display it
                        $("#loggedInUser").text("User: " + userId);
                        $("#userInfo").css("display", "block");

                        if (msg.d.isAdmin) {
                            $("#managerDashboardLink").css("display", "inline");
                        }
                        else {
                            $("#managerDashboardLink").css("display", "none");
                        }

                        // Fetch and display user points on login
                        fetchUserPoints(userId);

                        // Display user streak on log in
                        if (sessionStorage.getItem('userId')) {
                            getStreak();
                        }


                    }
                    else {
                        //server replied false, so let the user know
                        //the logon failed
                        alert("logon failed");
                    }
                },
                error: function (e) {

                    alert("boo...");
                }
            });
        }

        function clearData() {
            clearLogon();
            clearUser();
        }

        //resets the logon inputs
        function clearLogon() {
            $('#logonId').val("");
            $('#logonPassword').val("");
        }

        //hide user info
        function clearUser() {
            // Hide user info
            $("#userInfo").css("display", "none");
            $("#loggedInUser").text(""); // Clear the username
        }

        // Function to log off
        function logOut() {
            var webMethod = "ProjectServices.asmx/LogOut";
            var parameters = "{}";
            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d) {
                        showPanel('logonPanel');
                        clearUser();
                    }
                },
                error: function (e) {

                    alert("boo...");
                }
            });
        }

        $(document).ready(function () {
            $("#togglePostForm").click(function () {
                $("#postFormContainer").slideToggle();
            });
        });

        // Function to handle the post submission
        function submitPost(event) {
            event.preventDefault(); // Prevent form from reloading the page

            // Get the title and content of the post
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const category = document.getElementById('postCategory').value;


            // Extract the logged-in user ID from the displayed username
            const userText = $("#loggedInUser").text(); // Example: "User: username"
            const userId = userText.replace("User: ", "").trim(); // Extracts only the username

            // Get current date to check if it's the user's first post of the day
            const currentDate = new Date().toISOString().split('T')[0]; // Format YYYY-MM-DD

            // Web method to check the user's last post date
            var webMethod = "ProjectServices.asmx/GetLastPostDate";
            var parameters = "{\"userId\":\"" + encodeURI(userId) + "\"}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d) {
                        let lastPostDate = msg.d; // Date of the last post made by the user
                        let pointsAwarded = 0;

                        // If the user has never posted today, award points
                        if (lastPostDate !== currentDate) {
                            pointsAwarded = 5; // Award 5 points for the first post of the day

                            // Update points in the accounts table (server-side)
                            var updatePointsMethod = "ProjectServices.asmx/UpdatePoints";
                            var updatePointsParameters = "{ \"userId\":\"" + encodeURI(userId) + "\", \"points\":\"" + pointsAwarded + "\"}";

                            $.ajax({
                                type: "POST",
                                url: updatePointsMethod,
                                data: updatePointsParameters,
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function () {
                                    // Successfully updated points in the accounts table
                                    updatePointsDisplay(userId); // Update the points displayed on the user info panel
                                },
                                error: function (e) {
                                    alert("Error updating points.");
                                }
                            });
                        }

                        // Now, submit the post
                        var createPostMethod = "ProjectServices.asmx/CreatePost";
                        var parameters = "{ \"title\":\"" + encodeURI(title) + "\",\"content\":\"" + encodeURI(content) + "\", \"userId\":\"" + encodeURI(userId) + "\"}";

                        $.ajax({
                            type: "POST",
                            url: createPostMethod,
                            data: parameters,
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (msg) {
                                alert("Post Submitted");
                                GetPosts(); // Refresh posts after submission
                                updateStreak(); // Update the streak after posting
                            },
                            error: function (e) {
                                alert("Error submitting post.");
                            }
                        });

                        // Reset the form and hide it
                        document.getElementById('postForm').reset();
                        document.getElementById('postFormContainer').style.display = 'none';
                    } else {
                        alert("Error: Unable to fetch last post date.");
                    }
                },
                error: function (e) {
                    alert("Error fetching last post date.");
                }
            });
        }

        var postsArray;
        //Function to display posts made
        function GetPosts() {
            const currentUserId = sessionStorage.getItem('userId'); // Current logged-in user
            const isAdmin = sessionStorage.getItem('admin') === 'true';

            var webMethod = "ProjectServices.asmx/GetPosts";
            var parameters = "{}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d.length > 0) {
                        postsArray = msg.d;
                        postsArray.sort((a, b) => b.upvoteCount - a.upvoteCount); // Sort posts by upvotes
                        $("#postsContainer").empty(); // Clear the container before appending new posts

                        for (var i = 0; i < postsArray.length; i++) {
                            // Status only shows if its not null or unreviewed
                            if (postsArray[i].status && postsArray[i].status !== "Unreviewed") {
                                status = `<span id = 'status'> ${postsArray[i].status}</span>`;
                            } else {
                                status = "";
                            }

                            // Edit and Delete buttons only appear for those with permissions
                            let editButton = "";
                            let deleteButton = "";

                            // Check permissions to display buttons
                            if (isAdmin || postsArray[i].userId === currentUserId) {
                                if (postsArray[i].userId === currentUserId) {
                                    editButton = `<button class='edit-btn' id='editBtn${postsArray[i].postId}'>Edit</button>`;
                                }
                                deleteButton = `<button class='delete-btn' id='deleteBtn${postsArray[i].postId}'>Delete</button>`;
                            }

                            // Generate HTML content for each post
                            var post = `
                            <div class='postRow' id='post${postsArray[i].postId}'>
                                <h3>${postsArray[i].title}</h3>
                                ${status}
                                <p class='postUser'>Posted by: ${postsArray[i].userId}</p>
                                <p class='post-text'>${postsArray[i].content}</p>

                                <!-- Vote buttons -->
                                <div class='vote-buttons'>
                                    <button class='upvote-button' onclick='votePost(${postsArray[i].postId}, 1)'>
                                        <img src='Images/Like.png' alt='Upvote' class='upvote-icon'>
                                    </button>
                                    <span id='upvoteCount-${postsArray[i].postId}' class='vote-count'>${postsArray[i].upvoteCount}</span>
                                    <button class='downvote-button' onclick='votePost(${postsArray[i].postId}, -1)'>
                                        <img src='Images/Dislike.png' alt='Downvote' class='downvote-icon'>
                                    </button>
                                    <span id='downvoteCount-${postsArray[i].postId}' class='vote-count'>${postsArray[i].downvoteCount}</span>
                                </div>

                                <!-- Post options (Edit and Delete buttons) -->
                                <div class='postOptions'>
                                    ${editButton}
                                    ${deleteButton}
                                </div>

                                <!-- Comment Section -->
                                <div class='comment-section'>
                                    <h4>Comments</h4>
                                    <div id='commentsContainer-${postsArray[i].postId}'></div>
                                    <form onsubmit='submitComment(event, ${postsArray[i].postId})'>
                                        <textarea id='commentInput-${postsArray[i].postId}' placeholder='Add a comment...' required></textarea>
                                        <button type='submit'>Submit Comment</button>
                                    </form>
                                </div>

                                <hr>
                            </div>
                        `;

                            // Append each post to the container
                            $("#postsContainer").append(post);

                            // Fetch and display comments for this post
                            GetComments(postsArray[i].postId);
                        }

                        // Add event listeners for Edit and Delete buttons after posts are rendered
                        $(".edit-btn").on("click", function () {
                            var postId = $(this).attr("id").replace("editBtn", "");
                            EditPost(postId);
                        });

                        $(".delete-btn").on("click", function () {
                            var postId = $(this).attr("id").replace("deleteBtn", "");
                            DeletePost(postId);
                        });
                    } else {
                        $("#postsContainer").append("<p>No posts available at the moment.</p>");
                    }
                },
                error: function (e) {
                    alert("Error fetching posts");
                }
            });
        }

        function GetQuestion() {
            var webMethod = "ProjectServices.asmx/GetQuestion";
            $.ajax({
                type: "POST",
                url: webMethod,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    document.getElementById("resultText").innerText = msg.d
                },
                error: function (e) {
                    document.getElementById("resultText").innerText = "Error fetching data."
                }
            });
        }

        function EditPost(postId) {
            var postTextElement = $(`#post${postId} .post-text`)
            var postContent = postTextElement.text();

            // Check if edit form is already open
            if (postTextElement.find("textarea").length > 0) {
                // If open, restore the original content (close the form)
                cancelPostEdit(postId);
                return; // Exit the function
            }

            postTextElement.data("originalContent", postContent);

            postTextElement.html(`
                <textarea id="editPostContent-${postId}">${postContent}</textarea>
                <button onclick="savePostEdit(${postId})">Save</button>
                <button onclick="cancelPostEdit(${postId})">Cancel</button>
            `);
        }

        function savePostEdit(postId) {
            var updatedContent = $(`#editPostContent-${postId}`).val(); // Get the updated content

            var webMethod = "ProjectServices.asmx/EditPost";
            var parameters = JSON.stringify({
                postId: postId,
                newContent: updatedContent
            });

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    alert(msg.d); // Show success or error message
                    GetPosts(); // Refresh posts after editing
                },
                error: function (e) {
                    alert("Error saving post: " + e.responseText);
                }
            });
        }
        function cancelPostEdit(postId) {
            var originalContent = $(`#post${postId} .post-text`).data("originalContent");

            // Restore the original content
            $(`#post${postId} .post-text`).html(originalContent);
        }

        function GetComments(postId) {
            var webMethod = "ProjectServices.asmx/GetComments";
            var parameters = JSON.stringify({ postId: postId });

            // Show loading state
            var commentsContainer = $(`#commentsContainer-${postId}`);
            commentsContainer.html("<p>Loading comments...</p>");

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    commentsContainer.empty(); // Clear existing comments

                    if (msg.d && msg.d.length > 0) {
                        msg.d.forEach((comment, index) => {
                            var commentHtml = renderComment(postId, comment, index);
                            commentsContainer.append(commentHtml);
                        });
                    } else {
                        commentsContainer.append("<p>No comments available.</p>");
                    }
                },
                error: function (e) {
                    commentsContainer.html("<p>Error loading comments. Please try again.</p>");
                    console.error("Error fetching comments:", e);
                }
            });
        }

        function renderComment(postId, comment, index) {
            var isCurrentUser = comment.userId === sessionStorage.getItem('userId');
            return `
            <div class="comment" id="comment-${postId}-${index}">
                <p>${DOMPurify.sanitize(comment.content)}</p>
                ${comment.isAnonymous ? "" : `<p class="comment-user">Posted by: ${DOMPurify.sanitize(comment.userId)}</p>`}
                ${isCurrentUser ? `
                    <button onclick="openEditForm(${postId}, ${index}, '${DOMPurify.sanitize(comment.content)}')">Edit</button>
                    <button onclick="deleteComment(${postId}, ${index})">Delete</button>
                ` : ""}
            </div>
            <div id="editForm-${postId}-${index}" style="display: none;">
                <textarea id="editContent-${postId}-${index}">${DOMPurify.sanitize(comment.content)}</textarea>
                <button onclick="saveEdit(${postId}, ${index}, '${DOMPurify.sanitize(comment.userId)}')">Save</button>
            </div>
            <hr>
        `;
        }

        function submitComment(event, postId) {
            event.preventDefault(); // Prevent form submission

            var commentInput = $("#commentInput-" + postId).val().trim();
            var submitButton = $(event.target).find("button[type='submit']");

            // Validate input
            if (commentInput === "") {
                alert("Comment cannot be empty!");
                return;
            }

            // Disable the submit button and show loading state
            submitButton.prop("disabled", true).text("Submitting...");

            var webMethod = "ProjectServices.asmx/SubmitComment";
            var parameters = JSON.stringify({
                postId: postId,
                content: commentInput,
                isAnonymous: false // Set to true if anonymous comments are supported
            });

            console.log("Submitting comment with parameters:", parameters); // Debugging

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    console.log("Server response:", msg); // Debugging

                    if (msg.d) {
                        // Clear the input field
                        $("#commentInput-" + postId).val("");

                        // Show success message
                        alert("Comment submitted successfully!");

                        // Refresh comments for the post
                        GetComments(postId);
                    } else {
                        alert("Failed to submit comment. Please try again.");
                    }
                },
                error: function (e) {
                    console.error("Error submitting comment:", e);
                    alert("Error submitting comment. Please try again.");
                },
                complete: function () {
                    // Re-enable the submit button and reset its text
                    submitButton.prop("disabled", false).text("Submit Comment");
                }
            });
        }

        // Function to delete a post with confirmation dialogue
        function DeletePost(postId) {

            let confirmDelete = confirm("Are you sure you want to delete this comment?");
            if (!confirmDelete) return;

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/DeleteComment",
                data: JSON.stringify({ postId: postId }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d === "Success") {
                        alert("Comment deleted successfully!");
                        GetPosts(); // Reload the posts
                    } else {
                        alert(msg.d);
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error: " + error);
                    alert("Failed to delete comment.");
                }
            });
        }

        // Function to upvote or downvote a post
        function votePost(postId, voteType) {

            var userId = getUserId();


            var webMethod = "ProjectServices.asmx/PostVotes";
            var parameters = JSON.stringify({
                "userId": userId,
                "postId": postId,
                "voteType": voteType
            });

            console.log("Sending parameters:", parameters);

            // Ensure voteType is either 1 or -1
            if (voteType !== 1 && voteType !== -1) {
                alert("Invalid vote type. Use 1 for upvote or -1 for downvote.");
                return;
            }

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    alert("Vote successful.");
                    GetPosts(); //refresh posts after voting

                },
                error: function (e) {
                    console.error("Error occurred during voting:", e);
                    console.error("Status:", e.status);
                    console.error("Response text:", e.responseText);
                    alert("An error occurred while voting. Check console for details.");
                }
            });
        }

        // Feedback displayed on the manager dashboard
        var feedbackArray;
        function managerFeedback() {

            var webMethod = "ProjectServices.asmx/GetFeedback";
            var parameters = "{}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d.length > 0) {
                        feedbackArray = msg.d;
                        $("#feedbackContainer").empty();

                        for (var i = 0; i < feedbackArray.length; i++) {

                            const currentStatus = feedbackArray[i].status ? feedbackArray[i].status : "Unreviewed";

                            const statusDropdown = `
                                    <select id="dropdown" onchange="updateStatus(${feedbackArray[i].postId}, this.value)">
                                        <option value="Unreviewed" ${currentStatus === "Unreviewed" ? "selected" : ""}>Unreviewed</option>
                                        <option value="Reviewed" ${currentStatus === "Reviewed" ? "selected" : ""}>Reviewed</option>
                                        <option value="In Progress" ${currentStatus === "In Progress" ? "selected" : ""}>In Progress</option>
                                        <option value="Resolved" ${currentStatus === "Resolved" ? "selected" : ""}>Resolved</option>
                                    </select>
                                    `

                            var feedback = `
                                        <div class='postRow' id='post${feedbackArray[i].postId}'>
                                            <h3>${feedbackArray[i].title}</h3>
                                            ${statusDropdown}
                                            <p class='postUser'>Posted by: ${feedbackArray[i].userId}</p>
                                            <p>${feedbackArray[i].content}</p>
                                            <div class='post-footer' id="feedback">
                                                <div class='post-upvote-count'>
                                                    Total Upvotes: <span id='upvoteCount-${feedbackArray[i].postId}'>${feedbackArray[i].upvoteCount}</span>
                                                </div>
                                            </div>
                                            <hr>
                                        </div>
                                    `;

                            // Append each post to the container
                            $("#feedbackContainer").append(feedback);

                        }
                    } else {
                        $("#feedbackContainer").append("<p>No posts available at the moment.</p>");
                    }
                },
                error: function (e) {
                    alert("Error fetching posts");
                }
            });
        }

        // Update post status
        function updateStatus(postId, newStatus) {
            if (!newStatus) return; // Ignore if no change

            $.ajax({
                type: "POST",
                url: "ProjectServices.asmx/SetStatus",
                data: JSON.stringify({ postId: postId, newStatus: newStatus }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    if (response.d === "Success") {
                        alert("Status updated successfully!");
                        managerFeedback(); // Reload to show updated status
                    } else {
                        alert("Failed to update status: " + response.d);
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error updating status:", error);
                }
            });
        }

        // Function to check the user's streak
        function getStreak() {
            var userId = sessionStorage.getItem('userId');

            var webMethod = "ProjectServices.asmx/GetStreak";
            var parameters = "{\"userId\":\"" + encodeURI(userId) + "\"}"; // Send the user ID to the server

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    var streakData = msg.d.split(','); // Expected response: "streakCount,lastPostDate"
                    var streakCount = streakData[0];
                    var lastPostDate = streakData[1];

                    // Display the streak count to the user
                    $("#streakDisplay").text("Your streak: " + streakCount + " days (Last post: " + lastPostDate + ")");
                },
                error: function (e) {
                    alert("Error fetching streak data.");
                }
            });
        }

        // Function to update the user's streak when they submit a post
        function updateStreak() {
            var userId = sessionStorage.getItem('userId');
            var streakCount = 0; // Default value for streak count (will be updated with server response)
            var lastPostDate = new Date().toISOString().split('T')[0]; // Get today's date

            var webMethod = "ProjectServices.asmx/GetStreak";
            var parameters = "{\"userId\":\"" + encodeURI(userId) + "\"}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d && msg.d !== "0,No previous posts") {
                        var streakData = msg.d.split(','); // Expected response: "streakCount,lastPostDate"
                        streakCount = parseInt(streakData[0]);

                        // Check if the streak should be updated based on the last post date
                        var lastPostDateFromServer = new Date(streakData[1]);

                        // Update streak count if the user posts on consecutive days
                        var today = new Date();
                        var diffInTime = today.getTime() - lastPostDateFromServer.getTime();
                        var diffInDays = diffInTime / (1000 * 3600 * 24);

                        if (diffInDays === 1) {
                            streakCount++; // Increase streak if the user posted yesterday
                        } else if (diffInDays > 1) {
                            streakCount = 1; // Reset streak if the user hasn't posted for more than one day
                        }
                    }
                    else {
                        // If no streak data (i.e., the user is posting for the first time)
                        streakCount = 1; // Set streak to 1 on the first post
                    }

                    // Now, update the streak in the backend
                    var updateWebMethod = "ProjectServices.asmx/UpdateStreak";
                    var updateParameters = "{\"userId\":\"" + encodeURI(userId) + "\",\"streakCount\":\"" + streakCount + "\",\"lastPostDate\":\"" + lastPostDate + "\"}";

                    $.ajax({
                        type: "POST",
                        url: updateWebMethod,
                        data: updateParameters,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (msg) {
                            alert("Streak updated successfully!");
                            getStreak(); // Update streak on the front-end after posting
                        },
                        error: function (e) {
                            alert("Error updating streak data.");
                        }
                    });
                },
                error: function (e) {
                    alert("Error fetching streak data.");
                }
            });
        }

        // Function to update the points display on the user info panel
        function updatePointsDisplay(userId) {
            var webMethod = "ProjectServices.asmx/GetUserPoints";
            var parameters = "{\"userId\":\"" + encodeURI(userId) + "\"}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d) {
                        // Display the points on the user info panel
                        $("#userPoints").text("Points: " + msg.d);
                    }
                },
                error: function (e) {
                    alert("Error fetching points.");
                }
            });
        }

        // Function to fetch and display the user's points
        function fetchUserPoints(userId) {
            var webMethod = "ProjectServices.asmx/GetUserPoints";
            var parameters = "{\"userId\":\"" + encodeURI(userId) + "\"}";

            $.ajax({
                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (msg) {
                    if (msg.d !== undefined && msg.d !== null) {
                        // Update the points in the user info section
                        $("#userPoints").text("Points: " + msg.d);
                    }
                },
                error: function (e) {
                    alert("Error fetching user points.");
                }
            });
        }

        function getUserId() {
            return sessionStorage.getItem('userId'); // 
        }

        // Function to track post char limit
        function updateCharCount() {
            var textArea = document.getElementById("postContent");
            var charCount = document.getElementById("charCount");
            var remaining = 500 - textArea.value.length;
            charCount.textContent = remaining + " characters remaining";
        }

        // Function to navigate to the Manager Dashboard
        function goToManagerDashboard() {
            var userId = sessionStorage.getItem('userId');
            console.log("Retrieved userId from sessionStorage: " + userId); // Debugging log
            if (userId) {
                $("#managerDashboardPanel #loggedInUser").text("User: " + userId);

            } else {
                console.log("No userId found in sessionStorage");
            }
            showPanel('managerDashboardPanel');
            // Call the fetchDataAndRenderChart function to load the data and render the chart
            fetchChartData();
            managerFeedback();

            $("#managerDashboardLink").css("display", "none");
            $("#feedbackLink").css("display", "inline-block");
        }

        // Function to navigate to the Manager Dashboard
        function goToFeedback() {

            var isAdmin = sessionStorage.getItem('admin')
            showPanel('feedbackPanel');

            $("#loggedInUser").text("User: " + sessionStorage.getItem('userId'));
            $("#userInfo").css("display", "block");

            if (isAdmin) {
                $("#managerDashboardLink").css("display", "inline");
            }
            else {
                $("#managerDashboardLink").css("display", "none");
            }
            GetPosts();
        }
        // Ensure that posts are loaded when the page is ready
        $(document).ready(function () {
            showPanel("logonPanel");

        });

        // Function to filter feedback by time range
        function filterFeedbackByDate() {
            const startDate = new Date(document.getElementById('startDate').value);
            const endDate = new Date(document.getElementById('endDate').value);

            if (!startDate || !endDate) {
                alert("Please select both start and end dates.");
                return;
            }

            // Filter feedback data by time range
            const filteredData = feedbackData.filter(feedback => {
                const feedbackDate = new Date(feedback.timestamp);
                return feedbackDate >= startDate && feedbackDate <= endDate;
            });

            // Display filtered feedback
            displayFilteredFeedback(filteredData);
        }

        // Function to display filtered feedback in the UI
        function displayFilteredFeedback(filteredData) {
            const feedbackContainer = document.getElementById('feedbackContainer');
            feedbackContainer.innerHTML = ''; // Clear existing feedback

            if (filteredData.length === 0) {
                feedbackContainer.innerHTML = "<p>No feedback found for the selected time range.</p>";
                return;
            }

            filteredData.forEach(feedback => {
                const feedbackItem = document.createElement('div');
                feedbackItem.className = 'feedback-item';
                feedbackItem.innerHTML = `
                    <p><strong>Date:</strong> ${new Date(feedback.timestamp).toLocaleDateString()}</p>
                    <p><strong>Message:</strong> ${feedback.message}</p>
                `;
                feedbackContainer.appendChild(feedbackItem);
            });
        }

        let upvoteChartInstance = null;
        // Create data chart for upvotes per catergory from fetched data
        function upvoteChart(categories, upvoteCount) {

            const ctx = document.getElementById("upvoteChart").getContext('2d');


            if (ctx) {
                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: categories,
                        datasets: [{
                            label: 'Categories by Likes',
                            data: upvoteCount,
                            backgroundColor: ['#ff5733', '#33ff57', '#3357ff'],
                            borderColor: ['#ff5733', '#33ff57', '#3357ff'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: "top",
                            },
                        }
                    }


                });

            } else {
                console.error("Canvas context not found")
            }

        }

        let categoryChartInstance = null;
        // Function to create pie chart for total posts per category
        // Create data chart from fetched data
        function categoryChart(categories, posts) {
            const ctx = document.getElementById("categoryChart").getContext('2d');

            if (ctx) {
                const myChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: categories, // Categories as labels
                        datasets: [{
                            label: 'Categories by Total Posts',
                            data: posts,
                            backgroundColor: ['#ff5733', '#33ff57', '#3357ff', '#f39c12', '#8e44ad'], // Color for each slice
                            borderColor: ['#ffffff', '#ffffff', '#ffffff', '#ffffff', '#ffffff'], // White borders for slices
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: "top",
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (tooltipItem) {
                                        let label = tooltipItem.label || '';

                                        if (label) {
                                            label += ': ' + tooltipItem.raw; // Display the value for each slice
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

            } else {
                console.error("Canvas context not found");
            }
        }

        let postsLineChartInstance = null;
        // Function to create the line chart for category post total over 6 months
        function createLineChart(months, categories, postsData) {
            const ctx = document.getElementById("postsLineChart").getContext('2d');

            if (ctx) {
                const myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months, // X-axis is months
                        datasets: categories.map(category => ({
                            label: category,
                            data: postsData[category],
                            borderColor: ['#ff5733', '#33ff57', '#3357ff', '#f39c12', '#8e44ad'], // Generate a random color for each category
                            borderWidth: 2,
                            fill: false
                        }))
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Month'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Total Posts'
                                },
                                beginAtZero: true
                            }
                        }
                    }
                });
                postsData = postsData; // Save global data for export
            } else {
                console.error("Canvas context not found");
            }
        }


        // Fetch data needed for chart
        function fetchChartData() {
            // fetch category and total upvote count
            fetch('ProjectServices.asmx/GetUpvoteData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Raw Data:', data);
                    // Parse the data.d field to retrieve the actual JSON object
                    const parsedData = JSON.parse(data.d);
                    console.log('Parsed Data:', parsedData);

                    if (parsedData && parsedData.ChartInfo) {
                        const categories = parsedData.ChartInfo.map(item => item.category);
                        const upvoteCount = parsedData.ChartInfo.map(item => item.upvoteCount);
                        upvoteCategories = categories; // Store globally
                        upvoteCountData = upvoteCount; // Store the upvote counts globally

                        // Log the categories and data to verify
                        console.log("Upvote Categories: ", upvoteCategories);
                        console.log("Upvote Counts: ", upvoteCountData);
                        upvoteChart(categories, upvoteCount);

                    } else {
                        console.error('ChartInfo is missing or incorrect:', parsedData);
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });

            // Fetch total posts per category
            fetch('ProjectServices.asmx/GetCategoryData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    const parsedData = JSON.parse(data.d);
                    if (parsedData && parsedData.ChartInfo) {
                        const categories = parsedData.ChartInfo.map(item => item.category);
                        const posts = parsedData.ChartInfo.map(item => item.totalPosts);
                        categoryCategories = categories; // Store globally
                        categoryPosts = posts; // Store globally

                        // Log the categories and data to verify
                        console.log("Category Categories: ", categoryCategories);
                        console.log("Category Posts: ", categoryPosts);

                        categoryChart(categories, posts);
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });

            // Fetch total posts per category over the last 6 months
            fetch('ProjectServices.asmx/GetCategoryTimeData', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    console.log('Raw Data:', data);
                    const parsedData = JSON.parse(data.d);
                    console.log('Parsed Data:', parsedData);

                    if (parsedData && parsedData.ChartInfo) {
                        // Initialize arrays to store the months, categories, and total posts
                        const months = [];
                        const categories = new Set();
                        const totalPosts = {};

                        // Loop through the data and populate the months, categories, and totalPosts
                        parsedData.ChartInfo.forEach(item => {
                            // Collect months
                            if (!months.includes(item.month)) months.push(item.month);
                            // Collect categories
                            categories.add(item.category);

                            // Initialize totalPosts for each category if not already initialized
                            if (!totalPosts[item.category]) {
                                totalPosts[item.category] = new Array(months.length).fill(0);  // Initialize array with zeros
                            }

                            // Find the index for the current month in the months array
                            const monthIndex = months.indexOf(item.month);

                            // Set the total posts for the category at the correct month index
                            totalPosts[item.category][monthIndex] = parseInt(item.totalPosts);  // Parse to integer
                        });

                        // Convert the Set of categories to an array
                        const categoryArray = Array.from(categories);

                        postsData = totalPosts; // Store globally
                        // Call the function to create the line chart with the gathered data
                        createLineChart(months, categoryArray, totalPosts);
                    } else {
                        console.error('ChartInfo is missing or incorrect:', parsedData);
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        function exportToCSV(categories, data, filename) {
            // Log categories and data before exporting to check if they are populated correctly
            console.log('Exporting Categories: ', categories);
            console.log('Exporting Data: ', data);

            if (categories.length !== data.length) {
                console.error('Mismatch in the number of categories and data.');
                return; // Prevent export if categories and data don't match
            }

            // Ensure that both categories and data are properly mapped
            const chartData = categories.map((category, index) => ({
                Category: category,
                Data: data[index]
            }));

            // Convert the data to CSV format using PapaParse
            const csv = Papa.unparse(chartData);

            // Create a hidden link to download the CSV
            const hiddenElement = document.createElement('a');
            hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            hiddenElement.target = '_blank';
            hiddenElement.download = filename; // Dynamic filename
            hiddenElement.click();
        }

        function exportToPDF(categories, data, filename) {

            // Log categories and data before exporting to check if they are populated correctly
            console.log('Exporting Categories: ', categories);
            console.log('Exporting Data: ', data);

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(`${filename} Data`, 10, 10);

            let yPosition = 20;
            // Loop through categories and data and add to PDF
            categories.forEach((category, index) => {
                doc.text(`${category}: ${data[index]}`, 10, yPosition);
                yPosition += 10; // Adjust the y-position for each entry
            });

            doc.save(filename);
        }

        function exportLineChartToCSV(months, categories, totalPosts, filename) {
            // Log months, categories, and data before exporting to check if they are populated correctly
            console.log('Exporting Line Chart Months: ', months);
            console.log('Exporting Line Chart Categories: ', categories);
            console.log('Exporting Line Chart Data: ', totalPosts);

            if (categories.length !== Object.keys(totalPosts).length || months.length === 0) {
                console.error('Mismatch in the number of categories or months.');
                return; // Prevent export if there are any issues
            }

            // Prepare the chart data with months as the first column
            const chartData = months.map((month, index) => {
                const row = { Month: month };  // Start with the month
                categories.forEach(category => {
                    row[category] = totalPosts[category][index]; // Add the data for each category
                });
                return row;
            });

            // Convert the data to CSV format using PapaParse
            const csv = Papa.unparse(chartData);

            // Create a hidden link to download the CSV
            const hiddenElement = document.createElement('a');
            hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            hiddenElement.target = '_blank';
            hiddenElement.download = filename; // Dynamic filename
            hiddenElement.click();
        }

        function exportLineChartToPDF() {
            console.log('Exporting Line Chart Months: ', Object.keys(postsData));
            console.log('Exporting Line Chart Categories: ', Object.keys(postsData));
            console.log('Exporting Line Chart Data: ', postsData);

            const months = Object.keys(postsData);
            const categories = Object.keys(postsData);

            if (months.length === 0 || categories.length === 0) {
                console.error('No data available for export.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text('Line Chart Data', 10, 10);

            let yPosition = 20;

            // Display Months as the first row
            let monthText = 'Months: ' + months.join(', ');
            doc.text(monthText, 10, yPosition);
            yPosition += 10;

            // Display the data for each category below the month row
            categories.forEach((category) => {
                let dataText = `${category}: ${postsData[category].join(', ')}`;
                doc.text(dataText, 10, yPosition);
                yPosition += 10;
            });

            doc.save('line_chart_data.pdf');
        }


        document.addEventListener("DOMContentLoaded", function () {

            // Button event listeners for Upvote chart
            document.getElementById('exportUpvoteCSV').addEventListener('click', function () {
                // Log the categories and data before exporting
                console.log('Export Upvote Data:', upvoteCategories, upvoteCountData);
                exportToCSV(upvoteCategories, upvoteCountData, 'upvote_data.csv');
            });

            document.getElementById('exportUpvotePDF').addEventListener('click', function () {
                // Log the categories and data before exporting
                console.log('Export Upvote Data:', upvoteCategories, upvoteCountData);
                exportToPDF(upvoteCategories, upvoteCountData, 'upvote_data');
            });

            // Button event listeners for Category chart
            document.getElementById('exportCategoryCSV').addEventListener('click', function () {
                exportToCSV(categoryCategories, categoryPosts, 'category_data.csv');
            });

            document.getElementById('exportCategoryPDF').addEventListener('click', function () {
                exportToPDF(categoryCategories, categoryPosts, 'category_data');
            });

            // Button event listeners for Posts chart
            document.getElementById('exportPostsCSV').addEventListener('click', function () {
                const months = Object.keys(postsData); // Get the months for the posts chart
                exportLineChartToCSV(months, Object.keys(postsData), postsData, 'posts_data.csv');
            });

            document.getElementById('exportPostsPDF').addEventListener('click', function () {
                exportLineChartToPDF();
            });
        });


    </script>
    <!--END OF YOUR OWN JAVASCRIPT-->
    <!--AND YOUR OWN CSS CAN GO HERE AS WELL-->
    <style>
        html, body {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin: 0px;
            padding: 0px;
            overflow: hidden;
            font-family: 'Century Gothic';
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f2f5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background-color: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            font-size: 2rem;
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 600;
        }

        label {
            display: block;
            font-size: 1rem;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }

            .form-group label {
                font-size: 1rem;
                margin-right: 10px;
                color: #555;
                font-weight: 500;
            }

        #postTitle {
            flex-grow: 1;
            max-width: 50%; 
            padding: 10px 20px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        /* Category dropdown style */
        #postCategory {
            width: 25%; /* Set a fixed width for the category dropdown */
            padding: 12px 20px;
            font-size: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }


        input, textarea {
            width: 100%;
            padding: 12px 20px;
            margin: 10px 0 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background-color: #f9f9f9;
            transition: all 0.3s ease-in-out;
            box-sizing: border-box;
        }

            input:focus, textarea:focus {
                border-color: #007BFF;
                background-color: #fff;
                box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
                outline: none;
            }

        textarea {
            resize: vertical;
            min-height: 150px;
            font-family: system-ui;
        }

        .button-container {
            text-align: center;
        }

        button {
            padding: 12px 25px;
            font-size: 1rem;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

            button:hover {
                background-color: #0056b3;
            }

            button:focus {
                outline: none;
            }

        #postsContainer {
            margin-top: 30px;
            width: 100%;
        }

        .postUser {
            font-size: 0.9rem;
            font-weight: bold;
            color: gray;
            margin-top: -15px;
            margin-bottom: 5px;
            clear: left;
        }

        .weeklyQuestion {
            background-color: lightgrey;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid gray;
            border-radius: 7px;
            font-size: 20px;
            padding: 20px;
        }

        .title {
            font-size: 27px;
            font-weight: 520;
            padding-bottom: 6px;
        }

        #logonPanel, #feedbackPanel, #managerDashboardPanel {
            display: none;
        }

        #feedbackPanel, #managerDashboardPanel {
            width: 100%;
            max-height: 700px;
            overflow-y: auto;
        }

        #managerDashboardPanel {
            display: flex;
            flex-direction: column;
            padding: 20px;
            background-color: #f4f4f4;
            overflow: auto;
            width: 100%;
        }

        #logonPanel {
            max-width: 500px;
        }

        .button-container {
            width: 100%;
            display: flex;
            justify-content: center;
        }

        .button-containers {
            width: 100%;
            display: flex;
            justify-content: right;
        }

        #userInfo, #managerUserInfo {
            position: absolute;
            top: 10px;
            right: 20px;
            background-color: #007BFF;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            z-index:1;
        }

        #loggedInUser {
            font-weight: bold;
            margin-right: 15px;
        }

        #logOutButton {
            background-color: red;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #charCount {
            text-align: right;
            font-size: 14px;
            color: gray;
        }

        .post-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .vote-buttons {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .vote-count {
            font-size: 15px;
            color: #555;
            font: bold;
        }

        .upvote-button, .downvote-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        .upvote-icon, .downvote-icon {
            width: 30px;
            height: 30px;
        }

        .postOptions {
            position: absolute;
            top: 10px;
            right: 10px;
            border: none;
        }

            .postOptions button {
                font-size: 13px;
                background-color: transparent;
                color: dimgray;
                padding: 8px;
                line-height: 0px;
            }

                .postOptions button:hover {
                    text-decoration: underline;
                }

        .postRow {
            position: relative;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
        }

        #managerDashboardLink, #feedbackLink {
            display: none;
            font-size: 1.2rem;
            margin-right: 20px;
        }

            #managerDashboardLink a, #feedbackLink a {
                color: white;
                font-size: 1rem;
                font-weight: bold;
                text-decoration: none;
            }

                #managerDashboardLink a:hover, #feedbackLink a:hover {
                    text-decoration: underline;
                }

        #feedback {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            position: relative;
            font-size: 14px;
            color: #555;
        }

        .post-upvote-count {
            margin-right: 10px;
            font-weight: bold;
            color: #333;
        }

        h3 {
            float: left;
            margin-top: 0px;
        }

        #status {
            color: white;
            clear: none;
            margin-top: 0px;
            margin-left: 8px;
            background-color: #559c4c;
            border-radius: 3px;
            font-size: 14px;
            padding: 5px;
        }

        .feedbackPopup {
            display: none;
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }

        #dropdown {
            float: right;
            color: darkgreen;
            margin-top: 0px;
            border-radius: 3px;
            font-size: 14px;
            padding: 5px;
        }

        #dashboardContent {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
            margin-top: 40px;
            width: 100%;
            box-sizing: border-box;
        }

        .chart-container {
            width: 30%;
            margin-bottom: 20px;
            height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
            flex-grow: 0;
            flex-shrink: 0;
        }

            .chart-container canvas {
                width: 100%;
                height: 300px;
                background-color: #f9f9f9;
                border: 1px solid #ddd;
                max-height: 300px;
            }

        .chart-buttons-container {
            margin-top: 15px;
            display: flex;
            flex-direction: row;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }


            #feedbackSection h2 {
                margin-bottom: 20px;
            }

            #feedbackSection p {
                margin-top: 10px;
                color: #555;
            }

        #feedbackContainer {
            margin-top: 40px;
        }

        #timeRangeFilter {
            margin-top: 40px;
            text-align: center;
        }

            #timeRangeFilter input {
                margin: 10px;
                padding: 8px;
            }

            #timeRangeFilter button {
                padding: 10px 20px;
                cursor: pointer;
                background-color: #007BFF;
                color: white;
                border: none;
                border-radius: 5px;
            }

                #timeRangeFilter button:hover {
                    background-color: #0056b3;
                }

        .button-containers {
            display: flex;
            flex-direction: row;
            align-items: center;
            margin-top: 10px;
            gap: 10px;
        }

        .export-btn {
            padding: 8px 16px;
            margin: 5px 0;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            width: 150px;
            text-align: center;
        }
            .export-btn:hover {
                background-color: #45a049;
            }

            .export-btn:focus {
                outline: none;
            }
    </style>
    <!--END OF YOUR OWN CSS-->
</head>
<body onload="GetQuestion()">

    <div id="logonPanel" class="container">
        <h1>Log In</h1>
        <form onsubmit="LogOn($('#logonId').val(), $('#logonPassword').val()); return false;">

            <label for="userId">Username</label>
            <input type="text" id="logonId" placeholder="Enter your username" required>

            <label for="password">Password</label>
            <input type="password" id="logonPassword" placeholder="Enter your password" required>

            <div class="button-container">
                <button type="submit">Log In</button>
            </div>
        </form>
    </div>


    <!--Post Suggestion Form-->
    <div id="feedbackPanel" class="container">

        <!-- User Info Display -->
        <div id="userInfo">
            <!-- Manager Dashboard Link (only visible for admin users) -->
            <div id="managerDashboardLink">
                <a href="javascript:goToManagerDashboard();">Manager Dashboard</a>
            </div>

            <span id="loggedInUser"></span>
            <button id="logOutButton" onclick="logOut()">Log Out</button>
            <div id="userPoints"></div>
            <div id="streakDisplay"></div>
        </div>

        <div class="feedbackPopup">
            <p>Don't forget to engage! Provide feedback on posts to help improve our community.</p>
        </div>


        <!--Weekly Question-->
        <div class="weeklyQuestion">
            <div class="title">
                <span>Weekly Question</span>
            </div>
            <span id="resultText"></span>
        </div>




        <h1>Feedback Dashboard</h1>
        <div class="button-container">
            <button id="togglePostForm">Post Suggestion</button>
        </div>

        <div id="postFormContainer" style="display: none;">
            <h1>Create a Suggestion</h1>
            <form id="postForm" onsubmit="submitPost(event)">
                <div class="form-group">

                    <label for="postTitle">Post Title</label>
                    <input type="text" id="postTitle" name="postTitle" placeholder="Enter the title of your post" required>

                    <!-- Category Selection Dropdown -->
                    <label for="postCategory">Category:</label>
                    <select id="postCategory" required>
                        <option value="projects">Projects</option>
                        <option value="manager">Manager</option>
                        <option value="team">Team</option>
                        <option value="general">General</option>
                    </select><br>
                </div>


                <!--Content for feedback form limited to 500 chars-->
                <label for="postContent">Post Content</label>
                <textarea id="postContent" name="postContent" placeholder="Write your post content here" required maxlength="500" oninput="updateCharCount()"></textarea>
                <p id="charCount">500 characters remaining</p>



                <div class="button-containter">
                    <button type="submit">Submit Post</button>
                </div>
            </form>
        </div>

        <!--Container for posts-->
        <div id="postsContainer"></div>

    </div>

    <!-- Manager Dashboard Panel (initially hidden) -->
    <div id="managerDashboardPanel" class="container">
        <h1>Manager Dashboard</h1>

        <div id="dashboardContent">
            <div class="chart-container">
                <canvas id="upvoteChart"></canvas>
                <!-- Export buttons for Upvote Chart -->
                <div class="chart-buttons-container">
                    <button id="exportUpvoteCSV" class="export-btn">Export CSV</button>
                    <button id="exportUpvotePDF" class="export-btn">Export PDF</button>
                </div>

            </div>

            <div class="chart-container">
                <canvas id="categoryChart"></canvas>
                <!-- Export buttons for Category Chart -->
                <div class="chart-buttons-container">
                    <button id="exportCategoryCSV" class="export-btn">Export CSV</button>
                    <button id="exportCategoryPDF" class="export-btn">Export PDF</button>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="postsLineChart"></canvas>
                <div class="chart-buttons-container">
                    <button id="exportPostsCSV" class="export-btn">Export CSV</button>
                    <button id="exportPostsPDF" class="export-btn">Export PDF</button>
                </div>
            </div>


            <!-- User Info Display -->
            <div id="managerUserInfo">
                <!-- Feedback Dashboard Link return -->
                <div id="feedbackLink">
                    <a href="javascript:goToFeedback();">Feedback</a>
                </div>

                <span id="loggedInUser"></span>
                <button id="logOutButton" onclick="logOut()">Log Out</button>

            </div>

            <div id="timeRangeFilter">
                <h2>Filter Feedback by Time Range</h2>
                <div>
                    <label for="startDate">Start Date:</label>
                    <input type="date" id="startDate">

                    <label for="endDate">End Date:</label>
                    <input type="date" id="endDate">

                    <button onclick="filterFeedbackByDate()">Filter Feedback</button>
                </div>
            </div>
            <!-- Add manager-specific content here -->
            <div id="feedbackContainer"></div>
        </div>
    </div>
        <!--<button onclick="javascript: TestButtonHandler();">Click here to test connection!</button>-->
</body>
</html>
